import{d as P,D as _,a as R,l as a,w as o,F as O,b as p,o as k,x as b,S as w,T as y}from"./index-WWavzJPV.js";import{v as F,P as B,T as H,a as x,C as M,V as J,b as W,c as E,s as D}from"./VStepper-CD5EFS6a.js";import{a as $,V as j}from"./index-BHrNHZeN.js";import{V as I,a as L,b as U,c as V}from"./VCard-C7iD426i.js";import"./index-CfstKSwk.js";function g(){return F()}function A(m){const e=/\d+/gi,i=m.match(e);if(i==null||i.length!=4)throw new Error("无效的时间格式："+m);const c=new Date;c.setUTCHours(+i[0]),c.setUTCMinutes(+i[1]),c.setUTCSeconds(0),c.setUTCMilliseconds(0);const s=new Date;return s.setUTCHours(+i[2]),s.setUTCMinutes(+i[3]),s.setUTCSeconds(0),s.setUTCMilliseconds(0),{start:c,end:s}}function z(m){const e=new B,i=new Map,c=new Map;return m.subject_name.forEach((s,f)=>{const u=g();i.set(f,u),e.Subjects.set(u,{Name:s,Initial:f,TeacherName:"",IsOutDoor:!1})}),m.timetable.forEach((s,f)=>{const u=g();c.set(f,u);const n=new H;if(s.size<=0)return;n.Name=f;let S;const r=m.divider.get(f);s.forEach((d,h)=>{const C=new x,T=A(h);if(console.debug("匹配时间段：",T),C.StartSecond=T.start,C.EndSecond=T.end,S!=null&&(S.EndSecond=C.StartSecond),typeof d=="string"&&(C.TimeType=1),S=C,n.Layouts.push(C),typeof d=="number"&&r!=null&&r.includes(d)){const N=new Date(T.end.getTime()+120),v=new x;v.StartSecond=v.EndSecond=N,v.TimeType=2,n.Layouts.push(v)}});const t=n.Layouts[0],l=n.Layouts[n.Layouts.length-1];t.StartSecond.getUTCHours()==0&&t.StartSecond.getUTCMinutes()==0&&n.Layouts.shift(),l!=null&&l.EndSecond.getUTCHours()==23&&l.EndSecond.getUTCMinutes()==59&&n.Layouts.pop(),n.Layouts.sort((d,h)=>d.StartSecond.getUTCSeconds()-h.EndSecond.getUTCSeconds()),e.TimeLayouts.set(u,n)}),m.daily_class.forEach((s,f)=>{const u=new M,n=new M;let S=!1;const r=s.timetable;console.log(r,s);const t=c.get(s.timetable);t!=null&&(u.Name=n.Name=s.Chinese+s.English,u.TimeRule.WeekDay=n.TimeRule.WeekDay=f,u.TimeLayoutId=n.TimeLayoutId=t,s.classList.forEach(l=>{if(typeof l=="string"){const d=i.get(l);u.Classes.push({SubjectId:d??""}),n.Classes.push({SubjectId:d??""})}else{S=!0;const d=i.get(l[0]),h=l.length>=1?i.get(l[1]):void 0;u.Classes.push({SubjectId:d??""}),n.Classes.push({SubjectId:h??""})}}),S?(u.TimeRule.WeekCountDiv=1,u.Name+=" 单",n.TimeRule.WeekCountDiv=2,n.Name+=" 双",e.ClassPlans.set(g(),u),e.ClassPlans.set(g(),n)):e.ClassPlans.set(g(),u))}),e}function G(m){const e=Function(m+`
return scheduleConfig`)();return console.log(e),e.subject_name=new Map(Object.entries(e.subject_name)),e.divider=new Map(Object.entries(e.divider)),e.timetable=new Map(Object.entries(e.timetable)),e.timetable.forEach((i,c)=>{e.timetable.set(c,new Map(Object.entries(i)))}),e}const q=p("h1",{class:"text-h3 text-sm-h3"},"从Electron Class Schedule迁移",-1),K=p("br",null,null,-1),Q=p("br",null,null,-1),X=p("br",null,null,-1),Y=p("br",null,null,-1),Z=p("br",null,null,-1),ee=p("br",null,null,-1),te=p("br",null,null,-1),se=p("br",null,null,-1),ne=p("br",null,null,-1),ce=P({__name:"ecs",setup(m){const e=_(null),i=_(""),c=_(!1),s=_(!1),f=_(null);function u(){if(c.value=!1,f.value=null,e.value){const r=new FileReader;r.onload=t=>{var l;i.value=(l=t.target)==null?void 0:l.result},r.readAsText(e.value)}s.value=!0}function n(r,t){const l=t instanceof Object?JSON.stringify(t,null,4):t,d=window.URL||window.webkitURL||window,h=new Blob([l]),C=document.createElement("a");C.href=d.createObjectURL(h),C.download=r,C.click()}function S(){try{const r=G(i.value),t=z(r);console.log(t),c.value=!0;const l=URL.createObjectURL(new Blob([D(t)],{type:"application/json"}));console.log("下载链接：",l),n("ProfileECS.json",D(t))}catch(r){f.value=r,c.value=!1}}return(r,t)=>(k(),R(O,null,[q,K,a(J,{items:["说明","上传ECS配置","转换"]},{"item.1":o(()=>[a(I,{flat:""},{default:o(()=>[a(L,null,{default:o(()=>[a(U,null,{default:o(()=>[b("转换说明")]),_:1})]),_:1}),a(V,null,{default:o(()=>[b(" 本转换向导将提供将Electron Class Schedule基于JS的配置文件 (scheduleConfig.js) 转换为ClassIsland档案文件的服务。 "),Q,b(" 上传您的ECS配置文件 (基于JS)，然后点击开始转换。 "),X,b(" 转换完成后，ClassIsland档案文件将会自动下载，您可以将其导入到ClassIsland中 (直接放入Profiles文件夹)。 ")]),_:1})]),_:1})]),"item.2":o(()=>[a(I,{flat:""},{default:o(()=>[a(L,null,{default:o(()=>[a(U,null,{default:o(()=>[b("上传ECS配置")]),_:1})]),_:1}),a(V,null,{default:o(()=>[b(" 请上传您的ECS配置文件 (scheduleConfig.js)。 "),Y,Z,a(W,{modelValue:e.value,"onUpdate:modelValue":t[0]||(t[0]=l=>e.value=l),accept:"text/javascript",label:"上传配置文件",onMultiple:l=>!1,onChange:t[1]||(t[1]=l=>u())},null,8,["modelValue"])]),_:1})]),_:1})]),"item.3":o(()=>[a(I,{flat:""},{default:o(()=>[a(L,null,{default:o(()=>[a(U,null,{default:o(()=>[b("转换")]),_:1})]),_:1}),a(V,null,{default:o(()=>[b(" 确认上传文件无误后，请点击“开始转换”。 "),ee,te,w(a($,{onClick:t[2]||(t[2]=l=>S())},{default:o(()=>[b("开始转换")]),_:1},512),[[y,s.value]]),se,ne,a(j,null,{default:o(()=>[w(a(E,{title:"转换完成",text:"ClassIsland档案文件将会自动下载，您可以将其导入到ClassIsland中(直接放入Profiles文件夹)。",type:"success"},null,512),[[y,c.value]])]),_:1}),a(j,null,{default:o(()=>[w(a(E,{title:"请先上传文件",text:"请先上传您的ECS配置文件 (scheduleConfig.js)。",type:"warning"},null,512),[[y,!s.value]])]),_:1}),a(j,null,{default:o(()=>[w(a(E,{title:"转换失败",text:"转换过程中发生错误，请检查您的配置文件。"+f.value,type:"error"},null,8,["text"]),[[y,f.value]])]),_:1})]),_:1})]),_:1})]),_:1})],64))}});export{ce as default};
